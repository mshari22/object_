{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
        
        <div>
            <img src="{{ url_for('static', filename='uploads/' + p['image_path']) }}" style="width: 100%; height: 400px; object-fit: cover; border-radius: 15px;">
            <h1 style="margin: 20px 0;">{{ p['title'] }}</h1>
            <h2 style="color: #27ae60;">{{ "{:,.0f}".format(p['price']) }} ุฑูุงู</h2>
            
            <div style="display: flex; gap: 20px; background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <span><i class="fas fa-ruler-combined"></i> {{ p['area'] }} ูยฒ</span>
                <span><i class="fas fa-bed"></i> {{ p['rooms'] }} ุบุฑู</span>
                <span><i class="fas fa-bath"></i> {{ p['bathrooms'] }} ุญูุงู</span>
                <span><i class="fas fa-history"></i> ุนูุฑ {{ p['age'] }} ุณูุฉ</span>
            </div>
            
            <div style="background: white; padding: 25px; border-radius: 15px; line-height: 1.8;">
                <h3>ุชูุงุตูู ุงูุนูุงุฑ</h3>
                <p>{{ p['description'] }}</p>
            </div>

            <div style="margin-top: 30px; background: white; padding: 25px; border-radius: 15px;">
                <h3>๐ ุชูููู ุญู {{ p['district'] }}</h3>
                <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                    <div>๐ก๏ธ ุงูุฃูุงู: โญโญโญโญโญ</div>
                    <div>๐ฐ ูุคุดุฑ ุงูุณุนุฑ: ๐ ูุฑุชูุน</div>
                    <div>๐ซ ุฎุฏูุงุช: ูุชูุงูู</div>
                </div>
            </div>
        </div>

        <div>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);">
                <h3>ุชูุงุตู ูุน ุงููุงูู</h3>
                <a href="https://wa.me/966590192582" class="btn" style="width: 100%; text-align: center; margin-bottom: 10px; background: #25D366;"><i class="fab fa-whatsapp"></i> ูุงุชุณุงุจ</a>
                <button class="btn" style="width: 100%; background: #333;">๐ ุงุญุฌุฒ ุฒูุงุฑุฉ</button>
            </div>

            <div style="background: #1a1a1a; color: white; padding: 25px; border-radius: 15px; margin-top: 20px;">
                <h3>๐งฎ ุญุงุณุจุฉ ุงูุชูููู</h3>
                <label>ุงูุฑุงุชุจ ุงูุดูุฑู:</label>
                <input type="number" id="salary" style="width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: none;">
                <label>ุงูุฏูุนุฉ ุงูุฃููู:</label>
                <input type="number" id="downpayment" style="width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: none;">
                <button onclick="calculate()" class="btn" style="width: 100%; margin-top: 15px;">ุงุญุณุจ ุงููุณุท</button>
                <div id="result" style="margin-top: 15px; color: #27ae60; font-weight: bold;"></div>
            </div>
            
            <div id="map" style="height: 250px; border-radius: 15px; margin-top: 20px;"></div>
        </div>
    </div>
</div>

<script>
    // ููุฏ ุงูุฎุฑูุทุฉ
    var map = L.map('map').setView([{{ p['latitude'] }}, {{ p['longitude'] }}], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    L.marker([{{ p['latitude'] }}, {{ p['longitude'] }}]).addTo(map);

    // ููุฏ ุญุงุณุจุฉ ุงูุชูููู
    function calculate() {
        let salary = parseFloat(document.getElementById('salary').value);
        let down = parseFloat(document.getElementById('downpayment').value) || 0;
        let propertyPrice = {{ p['price'] }};
        
        if(!salary) { document.getElementById('result').innerText = "ูุฑุฌู ุฅุฏุฎุงู ุงูุฑุงุชุจ"; return; }
        
        // ุญุณุจุฉ ุชูุฑูุจูุฉ: ุงููุณุท ูุง ูุชุฌุงูุฒ 65% ูู ุงูุฑุงุชุจ
        let maxInstallment = salary * 0.65;
        let loanAmount = propertyPrice - down;
        // ูุฑุถูุฉ ูุงุฆุฏุฉ ุณูููุฉ 3% ููุฏุฉ 25 ุณูุฉ
        let monthlyRate = 0.03 / 12;
        let months = 25 * 12;
        let emi = loanAmount * monthlyRate * (Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
        
        if (emi > maxInstallment) {
            document.getElementById('result').innerText = "ุงููุณุท ุงููุชููุน: " + emi.toFixed(0) + " ุฑูุงู (ุนุงูู ุฌุฏุงู ุนูู ุฑุงุชุจู)";
            document.getElementById('result').style.color = "red";
        } else {
            document.getElementById('result').innerText = "ุงููุณุท ุงูุดูุฑู ุงูุชูุฑูุจู: " + emi.toFixed(0) + " ุฑูุงู";
            document.getElementById('result').style.color = "#27ae60";
        }
    }
</script>
{% endblock %}