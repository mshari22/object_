<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ t['dir'] }}">
<head>
    <meta charset="UTF-8">
    <title>{{ t['browse'] }} | OBJECT</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f4f6f8; margin: 0; padding-top: 80px; }
        
        /* ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ¨ÿßŸÜÿ®Ÿäÿ© (ŸÜŸÅÿ≥ ÿßŸÑÿ≥ÿ™ÿßŸäŸÑ) */
        .menu-btn { position: fixed; top: 20px; {{ t['align'] }}: 20px; z-index: 2000; background: #000; color: white; padding: 10px 15px; border-radius: 50%; cursor: pointer; border: none; }
        .sidebar { height: 100%; width: 0; position: fixed; z-index: 1500; top: 0; {{ t['align'] }}: 0; background: #111; overflow-x: hidden; transition: 0.5s; padding-top: 60px; }
        .sidebar a { padding: 15px 30px; text-decoration: none; font-size: 18px; color: #ddd; display: block; transition: 0.3s; text-align: {{ t['align'] }}; }
        .sidebar a:hover { color: #27ae60; background: #222; }
        .sidebar .closebtn { position: absolute; top: 10px; {{ 'left' if lang == 'ar' else 'right' }}: 20px; font-size: 36px; cursor: pointer; color: #fff; }

        /* ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ŸàÿßŸÑÿ¥ÿ®ŸÉÿ© */
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-body { padding: 15px; }
        
        /* ÿ≤ÿ± ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© */
        .btn-map { background: #f0f2f5; width: 100%; padding: 10px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 600px; border-radius: 10px; position: relative; height: 400px; }
        #map { width: 100%; height: 100%; border-radius: 10px; }
        .close-map { position: absolute; top: 10px; right: 10px; background: white; padding: 5px 10px; cursor: pointer; z-index: 4000; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <button class="menu-btn" onclick="openNav()"><i class="fas fa-bars"></i></button>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <h2 style="color:#27ae60; text-align:center;">OBJECT</h2>
        <a href="/"><i class="fas fa-home"></i> {{ t['home'] }}</a>
        <a href="/browse"><i class="fas fa-building"></i> {{ t['browse'] }}</a>
        <a href="/add"><i class="fas fa-plus"></i> {{ t['add'] }}</a>
        <a href="{{ url_for('set_language', lang='en' if lang == 'ar' else 'ar') }}" style="color:#27ae60;">
            <i class="fas fa-globe"></i> {{ t['lang_switch'] }}
        </a>
    </div>

    <div class="container">
        <h1>{{ t['browse'] }}</h1>
        <div class="grid">
            {% for p in properties %}
            <div class="card">
                <img src="{{ url_for('static', filename='uploads/' + p['image_path']) if p['image_path'] else 'https://via.placeholder.com/400' }}">
                <div class="card-body">
                    <h3>{{ p['title'] }}</h3>
                    <p style="color:#27ae60; font-weight:bold;">{{ p['price'] }} ÿ±ŸäÿßŸÑ</p>
                    <button class="btn-map" onclick="openMap({{ p['latitude'] }}, {{ p['longitude'] }})">üìç {{ t['feat1'] }}</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div id="mapModal" class="modal">
        <div class="modal-content">
            <span class="close-map" onclick="closeMap()">X</span>
            <div id="map"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        function openNav() { document.getElementById("mySidebar").style.width = "300px"; }
        function closeNav() { document.getElementById("mySidebar").style.width = "0"; }
        
        var map, marker;
        function openMap(lat, lng) {
            document.getElementById('mapModal').style.display = 'flex';
            if(!map) { map = L.map('map'); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map); }
            map.setView([lat, lng], 14);
            if(marker) map.removeLayer(marker);
            marker = L.marker([lat, lng]).addTo(map);
            setTimeout(() => { map.invalidateSize(); }, 200);
        }
        function closeMap() { document.getElementById('mapModal').style.display = 'none'; }
    </script>

</body>
</html>