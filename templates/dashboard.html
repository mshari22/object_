{% extends 'base.html' %}
{% block content %}
<div class="container">
    <!-- Page Header -->
    <div style="margin-bottom: 40px;" class="animate-in">
        <h1 class="section-title">{{ t['dashboard'] }}</h1>
        <p class="section-subtitle">{{ t['map_instructions'] }}</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 35px;" class="dashboard-grid">

        <!-- Interactive Map -->
        <div class="glass-card animate-in" style="animation-delay: 0.1s;">
            <h2 style="font-size: 1.4rem; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <div
                    style="width: 45px; height: 45px; background: linear-gradient(135deg, #00d4aa, #7c3aed); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-map-marked-alt" style="color: white;"></i>
                </div>
                {{ t['select_location_map'] }}
            </h2>

            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px;">
                <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                {{ t['click_map_to_select'] }}
            </p>

            <!-- Map Container -->
            <div id="map"
                style="width: 100%; height: 500px; border-radius: 16px; overflow: hidden; border: 2px solid var(--glass-border);">
            </div>

            <!-- Coordinates Display -->
            <div
                style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px;">
                        <i class="fas fa-map-pin"></i> {{ t['latitude'] }}
                    </label>
                    <div id="lat-display" style="font-size: 1.1rem; font-weight: 600; color: var(--primary);">24.7136
                    </div>
                </div>
                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px;">
                        <i class="fas fa-map-pin"></i> {{ t['longitude'] }}
                    </label>
                    <div id="lng-display" style="font-size: 1.1rem; font-weight: 600; color: var(--secondary);">46.6753
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Property Form -->
        <div class="glass-card animate-in" style="animation-delay: 0.2s;">
            <h2 style="font-size: 1.4rem; margin-bottom: 30px; display: flex; align-items: center; gap: 12px;">
                <div
                    style="width: 45px; height: 45px; background: var(--gradient-1); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-plus" style="color: white;"></i>
                </div>
                {{ t['add_property'] }}
            </h2>

            <form method="POST" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 20px;">
                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                        {{ t['property_name'] }}
                    </label>
                    <input type="text" name="title" placeholder="{{ t['property_name_placeholder'] }}" required
                        class="inp">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;" class="form-row-2">
                    <div>
                        <label
                            style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                            {{ t['price'] }} ({{ t['sar'] }})
                        </label>
                        <input type="number" name="price" placeholder="2500000" required class="inp">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                            {{ t['district'] }}
                        </label>
                        <input type="text" name="district" placeholder="{{ t['location_placeholder'] }}" required
                            class="inp">
                    </div>
                </div>

                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                        {{ t['property_type'] }}
                    </label>
                    <select name="type" class="inp">
                        <option value="villa">{{ t['villa'] }}</option>
                        <option value="apartment">{{ t['apartment'] }}</option>
                        <option value="land">{{ t['land'] }}</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;" class="form-row-3">
                    <div>
                        <label
                            style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                            {{ t['area'] }} ({{ t['area'] }})
                        </label>
                        <input type="number" name="area" placeholder="500" required class="inp">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                            {{ t['rooms'] }}
                        </label>
                        <input type="number" name="rooms" placeholder="5" class="inp">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                            {{ t['bathrooms'] }}
                        </label>
                        <input type="number" name="bathrooms" placeholder="3" class="inp">
                    </div>
                </div>

                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                        {{ t['age'] }} ({{ t['age'] }})
                    </label>
                    <input type="number" name="age" placeholder="2" class="inp">
                </div>

                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                        {{ t['notes'] }}
                    </label>
                    <textarea name="description" placeholder="{{ t['notes'] }}" rows="4" class="inp"></textarea>
                </div>

                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                        {{ t['location'] }}
                    </label>
                    <input type="text" name="location" placeholder="{{ t['location_placeholder'] }}" class="inp">
                </div>

                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 8px;">
                        <i class="fas fa-image"></i> {{ t['property_image'] }}
                    </label>
                    <div
                        style="background: rgba(255,255,255,0.03); border: 2px dashed var(--glass-border); border-radius: 14px; padding: 30px; text-align: center; transition: 0.3s;">
                        <i class="fas fa-cloud-upload-alt"
                            style="font-size: 32px; color: var(--primary); margin-bottom: 10px;"></i>
                        <input type="file" name="image" required style="color: var(--text-secondary);">
                    </div>
                </div>

                <!-- Hidden inputs for coordinates from map -->
                <input type="hidden" name="lat" id="lat-input" value="24.7136">
                <input type="hidden" name="lng" id="lng-input" value="46.6753">

                <button type="submit" class="btn"
                    style="width: 100%; justify-content: center; padding: 18px; font-size: 1.1rem;">
                    <i class="fas fa-rocket"></i>
                    {{ t['publish'] }}
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Initialize map centered on Riyadh
    const map = L.map('map').setView([24.7136, 46.6753], 11);

    // Add tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19
    }).addTo(map);

    // Add draggable marker
    let marker = L.marker([24.7136, 46.6753], {
        draggable: true
    }).addTo(map);

    // Update coordinates when marker is dragged
    marker.on('dragend', function (e) {
        const position = marker.getLatLng();
        updateCoordinates(position.lat, position.lng);
    });

    // Add marker on map click
    map.on('click', function (e) {
        marker.setLatLng(e.latlng);
        updateCoordinates(e.latlng.lat, e.latlng.lng);
    });

    // Function to update displayed and hidden input coordinates
    function updateCoordinates(lat, lng) {
        document.getElementById('lat-display').textContent = lat.toFixed(6);
        document.getElementById('lng-display').textContent = lng.toFixed(6);
        document.getElementById('lat-input').value = lat.toFixed(6);
        document.getElementById('lng-input').value = lng.toFixed(6);
    }
</script>

<style>
    /* Dashboard responsive */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 35px;
    }

    .form-row-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .form-row-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
    }

    @media (max-width: 900px) {

        .dashboard-grid,
        .container>div:nth-child(2) {
            grid-template-columns: 1fr !important;
        }
    }

    @media (max-width: 600px) {

        .form-row-2,
        .form-row-3 {
            grid-template-columns: 1fr !important;
        }

        div[style*="grid-template-columns: 1fr 1fr;"],
        div[style*="grid-template-columns: 1fr 1fr 1fr;"] {
            grid-template-columns: 1fr !important;
        }
    }

    /* Leaflet popup customization */
    .leaflet-popup-content-wrapper {
        background: rgba(20, 20, 30, 0.95);
        color: var(--text-primary);
        border-radius: 12px;
    }

    .leaflet-popup-tip {
        background: rgba(20, 20, 30, 0.95);
    }
</style>
{% endblock %}